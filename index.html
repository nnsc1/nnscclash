<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NNSC Clash: Celebration Edition</title>
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        :root { --gold: #ffd700; --blue: #00d2ff; --red: #ff3131; --neon: #39ff14; --dark: #05050a; }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial Black', sans-serif; color: white; touch-action: none; }
        
        #orientation-lock { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark); z-index: 10000; align-items: center; justify-content: center; text-align: center; }
        @media (orientation: portrait) { #orientation-lock { display: flex; } }

        #menu { position: absolute; width: 100%; height: 100%; background: radial-gradient(circle, #1a1a2e 0%, #000 100%); z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 5px; }
        #locker-room-display { display: flex; justify-content: center; align-items: flex-end; gap: 10px; width: 100%; height: 140px; }
        .locker-canvas { background: transparent; width: 60px; height: 100px; }
        
        .sel-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; width: 95%; max-width: 800px; }
        .slot { background: rgba(255,255,255,0.05); border: 1px solid var(--blue); border-radius: 8px; padding: 5px; text-align: center; font-size: 0.6rem; }
        .cycle-btn { background: var(--blue); border: none; color: white; padding: 5px; border-radius: 4px; }

        #hud { display: none; position: absolute; top: 5px; width: 100%; text-align: center; z-index: 60; pointer-events: none; }
        #scoreboard { font-size: 1.5rem; text-shadow: 2px 2px #000; }
        #timer { font-size: 0.9rem; color: var(--gold); }

        #goal-banner { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 200; font-size: 5rem; color: var(--gold); text-shadow: 0 0 20px #000; font-style: italic; animation: pulse 0.5s infinite alternate; }
        @keyframes pulse { from { transform: translate(-50%, -50%) scale(1); } to { transform: translate(-50%, -50%) scale(1.1); } }

        #controls { display: none; position: absolute; bottom: 0; width: 100%; height: 120px; z-index: 50; }
        #joy-base { position: absolute; bottom: 20px; left: 40px; width: 80px; height: 80px; background: rgba(255,255,255,0.1); border-radius: 50%; border: 2px solid white; }
        #joy-stick { position: absolute; top: 20px; left: 20px; width: 40px; height: 40px; background: white; border-radius: 50%; }
        
        .btn-grid { position: absolute; bottom: 20px; right: 40px; display: flex; gap: 10px; }
        .g-btn { width: 60px; height: 60px; border-radius: 50%; border: 2px solid white; color: white; font-weight: bold; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; }

        canvas { display: none; }
    </style>
</head>
<body>

<div id="orientation-lock"><div><h2 style="color: var(--gold)">PLEASE ROTATE DEVICE</h2></div></div>
<div id="goal-banner">GOAL!</div>

<div id="menu">
    <h2 style="color: var(--blue); margin: 5px;">NNSC LOCKER ROOM</h2>
    <div id="locker-room-display">
        <canvas id="pre-0" class="locker-canvas"></canvas>
        <canvas id="pre-1" class="locker-canvas"></canvas>
        <canvas id="pre-2" class="locker-canvas"></canvas>
        <canvas id="pre-3" class="locker-canvas"></canvas>
    </div>
    <div class="sel-grid" id="selectors"></div>
    <button style="margin-top: 10px; padding: 10px 40px; border-radius: 20px; background: var(--red); color: white; border: none; font-weight: bold;" onclick="startGame()">KICK OFF</button>
</div>

<div id="hud">
    <div id="scoreboard">BLUE 0 - 0 RED</div>
    <div id="timer">05:00</div>
</div>

<div id="controls">
    <div id="joy-base"><div id="joy-stick"></div></div>
    <div class="btn-grid">
        <div class="g-btn" id="shoot-btn" style="background: var(--red);">SHOOT</div>
        <div class="g-btn" id="switch-btn" style="background: var(--gold); color: black;">SWITCH</div>
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const PLAYER_DB = {
    '15Goalies': { nick: 'CHRIS B', skin: '#ffdbac' },
    '1300Melvin': { nick: 'MELVIN', skin: '#ffffff', hat: 'grad' },
    'angelolee1919': { nick: 'ANGELO', skin: '#8d5524', face: 'dog' },
    'CheekyBritishPerson1': { nick: 'CHEEKY', skin: '#ffffff' },
    'CristianoRonaldo9604': { nick: 'CRISTIANO', skin: '#c68642', face: 'dog' },
    'dvrianz': { nick: 'DVR', skin: '#444' },
    'E_Militao': { nick: 'EDER', skin: '#c68642' },
    'ElTatoYorugua': { nick: 'LEYENDA', skin: '#ffdbac', hat: 'redcap' },
    'EnesxRlo': { nick: 'ENES', skin: '#ffffff', antlers: true },
    'Fafumz': { nick: 'FAF', skin: '#ffffff' },
    'iHyperReal': { nick: 'ARDA', skin: '#444' },
    'J0ffPerc': { nick: 'J0FF', skin: '#333' },
    'JellozBenz': { nick: 'JELLO', skin: '#444', aura: true },
    'kenenmusss': { nick: 'KAAN', skin: '#444' },
    'mageman5304': { nick: 'MAGE', skin: '#333', hat: 'black' },
    'nascarremy16': { nick: 'REMY', skin: '#3d2b1f' },
    'petnilongo3': { nick: 'KAYN', skin: '#333', hat: 'diamond' },
    'psychx777': { nick: 'PSYCH', skin: '#ffffff', aura: true, antlers: true },
    'Salomaoarruda': { nick: 'SALAMANCA', skin: '#c68642' },
    'TG37074': { nick: 'TG', skin: '#333', face: 'fire' },
    'Tyranizard89': { nick: 'TYRAN', skin: '#8d5524', face: 'dino' }
};

const keys = Object.keys(PLAYER_DB);
let userTeamKeys = [keys[2], keys[5], keys[13], keys[1]];
let gameTime = 300, matchActive = false, score = [0, 0], joy = { x: 0, y: 0, active: false };
let players = [], ball = { x: 0, y: 0, vx: 0, vy: 0, r: 8 };
let isCelebrating = false, celebrator = null, celebType = 0;

function drawAvatar(ctx, x, y, k, teamColor, isSelected = false, pObj = null) {
    const data = PLAYER_DB[k];
    ctx.save();
    ctx.translate(x, y);

    // Celebration Animations
    if (isCelebrating && pObj === celebrator) {
        if (celebType === 0) ctx.rotate(Date.now() / 100); // Spin
        if (celebType === 1) ctx.translate(0, Math.sin(Date.now() / 50) * 20); // Jump
        if (celebType === 2) ctx.rotate(Math.sin(Date.now() / 100) * 0.5); // Wobble
        if (celebType === 3) { ctx.shadowBlur = 20; ctx.shadowColor = 'white'; } // Glow
    }

    if (isSelected && !isCelebrating) {
        ctx.strokeStyle = '#39ff14'; ctx.lineWidth = 3;
        ctx.beginPath(); ctx.ellipse(0, 18, 18, 8, 0, 0, 7); ctx.stroke();
    }

    ctx.fillStyle = teamColor; ctx.beginPath(); ctx.roundRect(-12, 5, 24, 20, 4); ctx.fill();
    ctx.fillStyle = data.skin; ctx.beginPath(); ctx.arc(0, -5, 12, 0, 7); ctx.fill();
    ctx.fillStyle = 'white'; ctx.beginPath(); ctx.arc(-4, -7, 3, 0, 7); ctx.fill(); ctx.beginPath(); ctx.arc(4, -7, 3, 0, 7); ctx.fill();
    ctx.fillStyle = 'black'; ctx.beginPath(); ctx.arc(-4, -7, 1.5, 0, 7); ctx.fill(); ctx.beginPath(); ctx.arc(4, -7, 1.5, 0, 7); ctx.fill();
    ctx.fillStyle = 'white'; ctx.font = 'bold 10px Arial'; ctx.textAlign = 'center'; ctx.fillText(data.nick, 0, -25);
    ctx.restore();
}

function cycle(slot, dir) {
    let idx = keys.indexOf(userTeamKeys[slot]);
    do { idx = (idx + dir + keys.length) % keys.length; } while (userTeamKeys.includes(keys[idx]));
    userTeamKeys[slot] = keys[idx];
    document.getElementById(`name-${slot}`).innerText = PLAYER_DB[userTeamKeys[slot]].nick;
    renderLocker();
}

function renderLocker() {
    userTeamKeys.forEach((k, i) => {
        const c = document.getElementById(`pre-${i}`);
        const ctxP = c.getContext('2d');
        ctxP.clearRect(0,0,c.width,c.height);
        drawAvatar(ctxP, c.width/2, 50, k, '#00d2ff', false);
    });
}

function startGame() {
    document.getElementById('menu').style.display = 'none';
    const canvas = document.getElementById('gameCanvas');
    canvas.style.display = 'block';
    document.getElementById('hud').style.display = 'block';
    document.getElementById('controls').style.display = 'block';
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    score = [0,0]; gameTime = 300; matchActive = true;
    let comKeys = keys.filter(k => !userTeamKeys.includes(k)).sort(() => 0.5 - Math.random()).slice(0, 4);
    players = [];
    userTeamKeys.forEach((k, i) => players.push({ key: k, team: 'u', pos: i, x: 100, y: (canvas.height/5)*(i+1), cur: i===3 }));
    comKeys.forEach((k, i) => players.push({ key: k, team: 'c', pos: i, x: canvas.width-100, y: (canvas.height/5)*(i+1), cur: false }));
    resetBall();
    requestAnimationFrame(loop);
}

function resetBall() {
    ball = { x: window.innerWidth / 2, y: window.innerHeight / 2, vx: 0, vy: 0, r: 8 };
}

function handleGoal(teamIndex, scorer) {
    score[teamIndex]++;
    isCelebrating = true;
    celebrator = scorer;
    celebType = Math.floor(Math.random() * 4);
    document.getElementById('goal-banner').style.display = 'block';
    
    setTimeout(() => {
        isCelebrating = false;
        celebrator = null;
        document.getElementById('goal-banner').style.display = 'none';
        resetBall();
    }, 5000);
}

function loop() {
    if (!matchActive) return;
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const cw = canvas.width, ch = canvas.height;

    ctx.fillStyle = '#1a472a'; ctx.fillRect(0,0,cw,ch);
    ctx.strokeStyle = 'rgba(255,255,255,0.4)'; ctx.lineWidth = 3;
    ctx.strokeRect(40, 20, cw-80, ch-40);
    ctx.beginPath(); ctx.moveTo(cw/2, 20); ctx.lineTo(cw/2, ch-20); ctx.stroke();
    
    ctx.strokeStyle = '#00d2ff'; ctx.strokeRect(5, ch/2-60, 35, 120);
    ctx.strokeStyle = '#ff3131'; ctx.strokeRect(cw-40, ch/2-60, 35, 120);

    if (!isCelebrating) {
        ball.x += ball.vx; ball.y += ball.vy;
        ball.vx *= 0.98; ball.vy *= 0.98;

        if(ball.y < 20 || ball.y > ch-20) ball.vy *= -1;
        if(ball.x < 40 || ball.x > cw-40) {
            if(ball.y > ch/2-60 && ball.y < ch/2+60) {
                // Find closest player to assign goal
                let scorer = players.reduce((prev, curr) => {
                    let dCurr = Math.hypot(curr.x - ball.x, curr.y - ball.y);
                    let dPrev = Math.hypot(prev.x - ball.x, prev.y - ball.y);
                    return dCurr < dPrev ? curr : prev;
                });
                handleGoal(ball.x < cw/2 ? 1 : 0, scorer);
            } else { ball.vx *= -1; }
        }
        if(ball.x < 0 || ball.x > cw || ball.y < 0 || ball.y > ch) resetBall();
    }

    players.forEach(p => {
        if (!isCelebrating) {
            if(p.cur) { p.x += joy.x*5; p.y += joy.y*5; }
            else {
                let tx = ball.x, ty = ball.y;
                if(p.pos === 0) { tx = p.team==='u'?60:cw-60; ty = Math.max(ch/2-50, Math.min(ch/2+50, ball.y)); }
                let dx = tx-p.x, dy = ty-p.y, dist = Math.sqrt(dx*dx+dy*dy);
                if(dist > 5) { p.x += (dx/dist)*4; p.y += (dy/dist)*4; }
            }
            p.x = Math.max(20, Math.min(cw-20, p.x));
            p.y = Math.max(20, Math.min(ch-20, p.y));
            let dx = ball.x-p.x, dy = ball.y-p.y, d = Math.sqrt(dx*dx+dy*dy);
            if(d < 22) { ball.vx = dx*0.5; ball.vy = dy*0.5; }
        }
        drawAvatar(ctx, p.x, p.y, p.key, p.team==='u'?'#00d2ff':'#ff3131', p.cur, p);
    });

    ctx.fillStyle = 'white'; ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.r, 0, 7); ctx.fill();
    document.getElementById('scoreboard').innerText = `BLUE ${score[0]} - ${score[1]} RED`;
    requestAnimationFrame(loop);
}

const selDiv = document.getElementById('selectors');
["GK", "DEF", "MID", "ATT"].forEach((pos, i) => {
    selDiv.innerHTML += `<div class="slot"><b>${pos}</b><br><span id="name-${i}">${PLAYER_DB[userTeamKeys[i]].nick}</span><br>
    <button class="cycle-btn" onclick="cycle(${i},-1)">◀</button> <button class="cycle-btn" onclick="cycle(${i},1)">▶</button></div>`;
});
renderLocker();

window.addEventListener('touchstart', e => {
    if (isCelebrating) return;
    const t = e.touches[0];
    const b = document.getElementById('joy-base').getBoundingClientRect();
    if(t.clientX > b.left && t.clientX < b.right) joy.active = true;
    if(e.target.id === 'switch-btn') {
        let idx = players.findIndex(p => p.cur); players[idx].cur = false;
        players[(idx + 1) % 4].cur = true;
    }
    if(e.target.id === 'shoot-btn') {
        let p = players.find(p => p.cur);
        let dx = (p.team==='u'?window.innerWidth:0)-p.x, dy = (window.innerHeight/2)-p.y, d = Math.sqrt(dx*dx+dy*dy);
        ball.vx = (dx/d)*15; ball.vy = (dy/d)*15;
    }
});
window.addEventListener('touchmove', e => {
    if(!joy.active || isCelebrating) return;
    const t = e.touches[0];
    const b = document.getElementById('joy-base').getBoundingClientRect();
    joy.x = (t.clientX - (b.left + 40)) / 40; joy.y = (t.clientY - (b.top + 40)) / 40;
});
window.addEventListener('touchend', () => { joy.active=false; joy.x=0; joy.y=0; });

setInterval(() => { 
    if(matchActive && gameTime > 0 && !isCelebrating) {
        gameTime--;
        let m = Math.floor(gameTime/60), s = gameTime%60;
        document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
    }
}, 1000);
</script>
</body>
</html>
