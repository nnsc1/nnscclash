<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>NNSC Clash: Pro Dribble</title>
    <style>
        :root { --gold: #ffd700; --blue: #00d2ff; --red: #ff3131; --neon: #39ff14; --dark: #05050a; }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial Black', sans-serif; color: white; touch-action: none; }
        #pwa-lock { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark); z-index: 20000; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; }
        #orientation-lock { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark); z-index: 10000; align-items: center; justify-content: center; }
        @media (orientation: portrait) { #orientation-lock { display: flex; } }
        #mvp-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .mvp-card { background: linear-gradient(145deg, #222, #000); border: 3px solid var(--gold); border-radius: 20px; padding: 30px; text-align: center; box-shadow: 0 0 50px rgba(255, 215, 0, 0.3); animation: mvpSlide 0.8s ease-out; }
        @keyframes mvpSlide { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        #menu { position: absolute; width: 100%; height: 100%; background: radial-gradient(circle, #1a1a2e 0%, #000 100%); z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .sel-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; width: 90%; margin-top: 10px; }
        .slot { background: rgba(255,255,255,0.05); border: 1px solid var(--blue); border-radius: 8px; padding: 5px; text-align: center; font-size: 0.6rem; }
        #hud { display: none; position: absolute; top: 10px; width: 100%; text-align: center; z-index: 60; pointer-events: none; }
        #controls { display: none; position: absolute; bottom: 0; width: 100%; height: 140px; z-index: 50; }
        #joy-base { position: absolute; bottom: 20px; left: 40px; width: 90px; height: 90px; background: rgba(255,255,255,0.1); border-radius: 50%; border: 2px solid white; }
        #joy-stick { position: absolute; top: 25px; left: 25px; width: 40px; height: 40px; background: white; border-radius: 50%; }
        .btn-grid { position: absolute; bottom: 20px; right: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .g-btn { width: 55px; height: 55px; border-radius: 50%; border: 2px solid white; color: white; display: flex; align-items: center; justify-content: center; font-size: 0.6rem; font-weight: bold; position: relative; }
        #goal-banner { display: none; position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%); z-index: 200; text-align: center; }
        #flash-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: white; opacity: 0; pointer-events: none; z-index: 199; }
    </style>
</head>
<body>

<div id="pwa-lock"><h2 style="color: var(--gold)">NNSC CLASH</h2><p>Add to Home Screen to Play</p></div>
<div id="orientation-lock"><div><h2 style="color: var(--gold)">ROTATE TO PLAY</h2></div></div>
<div id="flash-overlay"></div>

<div id="mvp-overlay">
    <div class="mvp-card">
        <div style="color: var(--gold); font-size: 1.2rem;">MATCH MVP</div>
        <canvas id="mvp-canvas" width="100" height="120"></canvas>
        <h2 id="mvp-name">PLAYER</h2>
        <div id="mvp-stats" style="color: #aaa;"></div>
        <button style="margin-top: 20px; padding: 10px 30px; background: var(--blue); color: white; border: none; border-radius: 20px;" onclick="location.reload()">REMATCH</button>
    </div>
</div>

<div id="goal-banner">
    <div style="font-size: 4rem; color: var(--gold); font-style: italic;">GOAL!</div>
    <div id="scorer-name" style="font-size: 2rem;">PLAYER</div>
</div>

<div id="menu">
    <div style="display:flex; gap:10px;">
        <canvas id="pre-0" width="60" height="90"></canvas>
        <canvas id="pre-1" width="60" height="90"></canvas>
        <canvas id="pre-2" width="60" height="90"></canvas>
        <canvas id="pre-3" width="60" height="90"></canvas>
    </div>
    <div class="sel-grid" id="selectors"></div>
    <button style="margin-top: 20px; padding: 15px 60px; border-radius: 30px; background: var(--red); color: white; border: none; font-weight: 900;" onclick="startGame()">KICK OFF</button>
</div>

<div id="hud">
    <div id="scoreboard" style="font-size: 1.5rem;">BLUE 0 - 0 RED</div>
    <div id="timer" style="color: var(--gold);">01:30</div>
</div>

<div id="controls">
    <div id="joy-base"><div id="joy-stick"></div></div>
    <div class="btn-grid">
        <div class="g-btn" id="pass-btn" style="background: var(--blue);">PASS</div>
        <div class="g-btn" id="shoot-btn" style="background: var(--red);">SHOOT</div>
        <div class="g-btn" id="pwr-btn" style="background: var(--neon); color: black;">PWR</div>
        <div class="g-btn" id="switch-btn" style="background: var(--gold); color: black;">SWITCH</div>
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const PLAYER_DB = {
    'angelolee1919': { nick: 'ANGELO', pwr: 'DOG POWER', skin: '#8d5524' },
    'Tyranizard89': { nick: 'TYRAN', pwr: 'DINOSAUR', skin: '#8d5524' },
    'TG37074': { nick: 'TG', pwr: 'YES SAR', skin: '#333' },
    'dvrianz': { nick: 'DVR', pwr: 'OG PLAYER', skin: '#444' },
    'NETHQES2': { nick: 'NETH', pwr: 'GOOD BROS', skin: '#ffdbac' },
    'J0ffPerc': { nick: 'J0FF', pwr: 'GYM', skin: '#333' },
    'EnesxRlo': { nick: 'ENES', pwr: 'TACKLE', skin: '#ffffff' },
    'E_Militao': { nick: 'EDER', pwr: 'SHUTDOWN', skin: '#c68642' },
    'mageman5304': { nick: 'MAGE', pwr: 'LOCKDOWN', skin: '#333' },
    'iHyperReal': { nick: 'ARDA', pwr: 'TYPEWRITER', skin: '#444' },
    '15Goalies': { nick: 'CHRIS B', pwr: 'ROOKIE', skin: '#ffdbac' },
    'CristianoRonaldo9604': { nick: 'CR7', pwr: 'DOG POWER', skin: '#c68642' },
    'JellozBenz': { nick: 'JELLO', pwr: 'OG PLAYER', skin: '#444' },
    'kenenmusss': { nick: 'KAAN', pwr: 'ASKIM', skin: '#444' },
    'ElTatoYorugua': { nick: 'LEYENDA', pwr: 'MILANESA', skin: '#ffdbac' },
    'petnilongo3': { nick: 'KAYN', pwr: 'FEIJOADA', skin: '#333' },
    '1300Melvin': { nick: 'MELVIN', pwr: 'DEPENDENCY', skin: '#ffffff' },
    'nascarremy16': { nick: 'REMY', pwr: 'INVIS', skin: '#3d2b1f' },
    'CheekyBritishPerson1': { nick: 'CHEEKY', pwr: 'SIDHU', skin: '#ffffff' },
    'psychx777': { nick: 'PSYCH', pwr: '7', skin: '#ffffff' },
    'Salomaoarruda': { nick: 'SALAMANCA', pwr: 'EGOIST', skin: '#c68642' }
};

let userTeamKeys = [Object.keys(PLAYER_DB)[0], Object.keys(PLAYER_DB)[3], Object.keys(PLAYER_DB)[7], Object.keys(PLAYER_DB)[10]];
let players = [], ball = { x: 0, y: 0, vx: 0, vy: 0, r: 8, possessor: null };
let matchActive = false, score = [0, 0], matchTime = 90, isCelebrating = false;

function drawAvatar(ctx, x, y, k, color, isSelected = false) {
    const d = PLAYER_DB[k];
    ctx.save(); ctx.translate(x, y);
    ctx.fillStyle = color; ctx.beginPath(); ctx.roundRect(-12, 5, 24, 18, 4); ctx.fill();
    ctx.fillStyle = d.skin; ctx.beginPath(); ctx.arc(0, -5, 11, 0, 7); ctx.fill();
    ctx.fillStyle = 'black'; ctx.beginPath(); ctx.arc(-4, -6, 1.5, 0, 7); ctx.fill(); ctx.beginPath(); ctx.arc(4, -6, 1.5, 0, 7); ctx.fill();
    if (isSelected) { ctx.strokeStyle = '#39ff14'; ctx.lineWidth = 2; ctx.beginPath(); ctx.ellipse(0, 18, 15, 6, 0, 0, 7); ctx.stroke(); }
    ctx.fillStyle = 'white'; ctx.font = 'bold 9px Arial'; ctx.textAlign = 'center'; ctx.fillText(d.nick, 0, -22);
    ctx.restore();
}

function startGame() {
    document.getElementById('menu').style.display = 'none';
    const canvas = document.getElementById('gameCanvas');
    canvas.style.display = 'block';
    document.getElementById('hud').style.display = 'block';
    document.getElementById('controls').style.display = 'block';
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    
    let comKeys = Object.keys(PLAYER_DB).filter(k => !userTeamKeys.includes(k)).sort(() => 0.5-Math.random()).slice(0, 4);
    players = [];
    userTeamKeys.forEach((k, i) => players.push({ key: k, team: 'u', pos: i, x: 150, y: (canvas.height/5)*(i+1), cur: i===3, s: 4.5, goals: 0, touches: 0 }));
    comKeys.forEach((k, i) => players.push({ key: k, team: 'c', pos: i, x: canvas.width-150, y: (canvas.height/5)*(i+1), cur: false, s: 4, goals: 0, touches: 0 }));
    
    resetBall();
    matchActive = true;
    requestAnimationFrame(loop);
    
    const timerInt = setInterval(() => {
        if(matchActive && !isCelebrating) {
            matchTime--;
            let m = Math.floor(matchTime/60), s = matchTime%60;
            document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
            if(matchTime <= 0) { clearInterval(timerInt); showMVP(); }
        }
    }, 1000);
}

function resetBall() { 
    ball = { x: window.innerWidth/2, y: window.innerHeight/2, vx: 0, vy: 0, r: 8, possessor: null }; 
}

function handleGoal(tIdx) {
    score[tIdx]++;
    isCelebrating = true;
    if(ball.possessor) ball.possessor.goals++;
    document.getElementById('scorer-name').innerText = ball.possessor ? PLAYER_DB[ball.possessor.key].nick : "GOAL";
    document.getElementById('goal-banner').style.display = 'block';
    document.getElementById('flash-overlay').style.opacity = '1';
    setTimeout(() => document.getElementById('flash-overlay').style.opacity = '0', 100);
    setTimeout(() => { isCelebrating = false; document.getElementById('goal-banner').style.display = 'none'; resetBall(); }, 3000);
}

function showMVP() {
    matchActive = false;
    const mvp = players.sort((a,b) => (b.goals*10 + b.touches) - (a.goals*10 + a.touches))[0];
    document.getElementById('mvp-overlay').style.display = 'flex';
    document.getElementById('mvp-name').innerText = PLAYER_DB[mvp.key].nick;
    document.getElementById('mvp-stats').innerText = `Goals: ${mvp.goals} | Touches: ${mvp.touches}`;
    drawAvatar(document.getElementById('mvp-canvas').getContext('2d'), 50, 60, mvp.key, mvp.team==='u'?'#00d2ff':'#ff3131');
}

function loop() {
    if (!matchActive) return;
    const ctx = document.getElementById('gameCanvas').getContext('2d'), cw = innerWidth, ch = innerHeight;
    ctx.fillStyle = '#1a472a'; ctx.fillRect(0,0,cw,ch);
    ctx.strokeStyle = 'white'; ctx.lineWidth = 2; ctx.strokeRect(40, 20, cw-80, ch-40);
    ctx.beginPath(); ctx.moveTo(cw/2, 20); ctx.lineTo(cw/2, ch-20); ctx.stroke();

    if (!isCelebrating) {
        if (ball.possessor) {
            ball.x = ball.possessor.x + (ball.possessor.team === 'u' ? 12 : -12);
            ball.y = ball.possessor.y + 10;
            ball.vx = 0; ball.vy = 0;
        } else {
            ball.x += ball.vx; ball.y += ball.vy; ball.vx *= 0.98; ball.vy *= 0.98;
            if(ball.y < 25 || ball.y > ch-25) ball.vy *= -1;
            if(ball.x < 45 || ball.x > cw-45) {
                if(ball.y > ch/2-60 && ball.y < ch/2+60) handleGoal(ball.x < cw/2 ? 1 : 0);
                else ball.vx *= -1;
            }
        }
    }

    // AI DECISIONS
    let closestToBall = players.reduce((prev, curr) => 
        Math.hypot(curr.x-ball.x, curr.y-ball.y) < Math.hypot(prev.x-ball.x, prev.y-ball.y) ? curr : prev);

    players.forEach(p => {
        if(!isCelebrating) {
            if(p.cur) {
                p.x += joy.x*5; p.y += joy.y*5;
            } else {
                let tx, ty;
                // IMPROVED TEAM AI
                if(ball.possessor && ball.possessor.team === p.team) { // Attack Support
                    tx = ball.x + (p.team === 'u' ? 100 : -100);
                    ty = p.pos === 1 ? ch*0.2 : (p.pos === 2 ? ch*0.8 : ch/2);
                } else if (p === closestToBall) { // Chase Ball
                    tx = ball.x; ty = ball.y;
                } else { // Defensive Positioning
                    tx = cw * (p.team === 'u' ? 0.2 : 0.8);
                    ty = p.pos === 0 ? ch/2 : (p.pos === 1 ? ch*0.3 : ch*0.7);
                }
                let d = Math.hypot(tx-p.x, ty-p.y);
                if(d > 5) { p.x += ((tx-p.x)/d)*p.s; p.y += ((ty-p.y)/d)*p.s; }
            }

            // POSSESSION LOGIC (GLUE)
            let dist = Math.hypot(p.x-ball.x, p.y-ball.y);
            if(dist < 25) {
                if(!ball.possessor || ball.possessor.team !== p.team) {
                    ball.possessor = p;
                    p.touches++;
                }
            }
        }
        p.x = Math.max(40, Math.min(cw-40, p.x)); p.y = Math.max(20, Math.min(ch-20, p.y));
        drawAvatar(ctx, p.x, p.y, p.key, p.team==='u'?'#00d2ff':'#ff3131', p.cur);
    });

    ctx.fillStyle = 'white'; ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.r, 0, 7); ctx.fill();
    document.getElementById('scoreboard').innerText = `BLUE ${score[0]} - ${score[1]} RED`;
    requestAnimationFrame(loop);
}

const keys = Object.keys(PLAYER_DB);
const selDiv = document.getElementById('selectors');
["GK", "DEF", "MID", "ATT"].forEach((pos, i) => {
    selDiv.innerHTML += `<div class="slot"><b>${pos}</b><br><span id="n-${i}">${PLAYER_DB[userTeamKeys[i]].nick}</span><br>
    <button onclick="cycle(${i},1)" style="background:var(--blue);border:none;color:white;border-radius:4px;padding:2px 5px;margin-top:2px;">CYCLE</button></div>`;
});

function cycle(s, d) {
    let i = keys.indexOf(userTeamKeys[s]);
    do { i = (i+d+keys.length)%keys.length; } while(userTeamKeys.includes(keys[i]));
    userTeamKeys[s] = keys[i];
    document.getElementById(`n-${s}`).innerText = PLAYER_DB[userTeamKeys[s]].nick;
    userTeamKeys.forEach((k, j) => drawAvatar(document.getElementById(`pre-${j}`).getContext('2d'), 30, 45, k, '#00d2ff'));
}
cycle(0,0);

let joy = { x: 0, y: 0, active: false };
window.addEventListener('touchstart', e => {
    const t = e.touches[0], b = document.getElementById('joy-base').getBoundingClientRect();
    if(t.clientX > b.left && t.clientX < b.right) joy.active = true;
    
    let p = players.find(pl => pl.cur);
    if(e.target.id === 'shoot-btn' && ball.possessor === p) {
        ball.possessor = null;
        ball.vx = (p.team === 'u' ? 1 : -1) * 25;
        ball.vy = (innerHeight/2 - ball.y) * 0.1;
    }
    if(e.target.id === 'pass-btn' && ball.possessor === p) {
        ball.possessor = null;
        ball.vx = (p.team === 'u' ? 1 : -1) * 15;
    }
    if(e.target.id === 'switch-btn') {
        let i = players.findIndex(pl=>pl.cur);
        players[i].cur = false;
        players[(i+1)%4].cur = true;
    }
});
window.addEventListener('touchmove', e => { 
    if(joy.active) { 
        const t = e.touches[0], b = document.getElementById('joy-base').getBoundingClientRect();
        joy.x = Math.max(-1, Math.min(1, (t.clientX-(b.left+45))/45));
        joy.y = Math.max(-1, Math.min(1, (t.clientY-(b.top+45))/45));
    } 
});
window.addEventListener('touchend', () => { joy.active = false; joy.x = 0; joy.y = 0; });
</script>
</body>
</html>
