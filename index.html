<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NNSC Clash: Locker Room</title>
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        :root { --gold: #ffd700; --blue: #00d2ff; --red: #ff3131; --neon: #39ff14; --dark: #05050a; }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial Black', sans-serif; color: white; touch-action: none; }
        
        /* Menu & Locker Room */
        #menu {
            position: absolute; width: 100%; height: 100%; background: radial-gradient(circle, #1a1a2e 0%, #000 100%);
            z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 20px;
        }
        #locker-room-display {
            display: flex; justify-content: center; align-items: flex-end; gap: 20px;
            width: 100%; height: 180px; margin-bottom: 10px; border-bottom: 2px solid rgba(255,255,255,0.1);
        }
        .locker-canvas { background: transparent; width: 80px; height: 120px; }
        
        .sel-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; width: 95%; max-width: 800px; }
        .slot { background: rgba(255,255,255,0.05); border: 1px solid var(--blue); border-radius: 10px; padding: 5px; text-align: center; font-size: 0.7rem; }
        .cycle-btn { background: var(--blue); border: none; color: white; padding: 8px; border-radius: 5px; margin: 2px; }

        /* HUD */
        #hud { display: none; position: absolute; top: 10px; width: 100%; text-align: center; z-index: 60; pointer-events: none; }
        #scoreboard { font-size: 1.8rem; text-shadow: 2px 2px #000; }
        #timer { font-size: 1.2rem; color: var(--gold); }

        /* Game UI */
        #controls { display: none; position: absolute; bottom: 0; width: 100%; height: 180px; z-index: 50; }
        #joy-base { position: absolute; bottom: 30px; left: 30px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%; border: 2px solid white; }
        #joy-stick { position: absolute; top: 25px; left: 25px; width: 50px; height: 50px; background: white; border-radius: 50%; }
        
        .btn-grid { position: absolute; bottom: 30px; right: 30px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .g-btn { width: 65px; height: 65px; border-radius: 50%; border: 3px solid white; color: white; font-weight: bold; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; }

        #end-screen { 
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); z-index: 300; flex-direction: column; align-items: center; justify-content: center;
        }

        canvas { display: none; }
    </style>
</head>
<body>

<div id="end-screen">
    <h1 id="match-result" style="font-size: 3rem;">FULL TIME</h1>
    <button style="padding: 15px 40px; background: var(--blue); color: white; border: none; border-radius: 20px;" onclick="returnToLocker()">RETURN TO LOCKER ROOM</button>
</div>

<div id="menu">
    <h1 style="color: var(--blue); margin: 0; font-size: 1.5rem;">NNSC LOCKER ROOM</h1>
    <div id="locker-room-display">
        <canvas id="pre-0" class="locker-canvas"></canvas>
        <canvas id="pre-1" class="locker-canvas"></canvas>
        <canvas id="pre-2" class="locker-canvas"></canvas>
        <canvas id="pre-3" class="locker-canvas"></canvas>
    </div>
    <div class="sel-grid" id="selectors"></div>
    <button style="margin-top: 15px; padding: 12px 60px; border-radius: 30px; background: var(--red); color: white; border: none; font-weight: bold;" onclick="startGame()">KICK OFF</button>
</div>

<div id="hud">
    <div id="timer">05:00</div>
    <div id="scoreboard">BLUE 0 - 0 RED</div>
</div>

<div id="controls">
    <div id="joy-base"><div id="joy-stick"></div></div>
    <div class="btn-grid">
        <div class="g-btn" style="background: var(--blue)">PASS</div>
        <div class="g-btn" id="shoot-btn" style="background: #fff; color: #000;">SHOOT</div>
        <div class="g-btn" id="switch-btn" style="background: var(--gold); color: black;">SWITCH</div>
        <div class="g-btn" id="pwr-btn" style="background: var(--neon); color: black;">PWR</div>
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const PLAYER_DB = {
    '15Goalies': { nick: 'CHRIS B', skin: '#ffdbac' },
    '1300Melvin': { nick: 'MELVIN', skin: '#ffffff', hat: 'grad' },
    'angelolee1919': { nick: 'ANGELO', skin: '#8d5524', face: 'dog' },
    'CheekyBritishPerson1': { nick: 'CHEEKY', skin: '#ffffff' },
    'CristianoRonaldo9604': { nick: 'CRISTIANO', skin: '#c68642', face: 'dog' },
    'dvrianz': { nick: 'DVR', skin: '#444' },
    'E_Militao': { nick: 'EDER', skin: '#c68642' },
    'ElTatoYorugua': { nick: 'LEYENDA', skin: '#ffdbac', hat: 'redcap' },
    'EnesxRlo': { nick: 'ENES', skin: '#ffffff', antlers: true },
    'Fafumz': { nick: 'FAF', skin: '#ffffff' },
    'iHyperReal': { nick: 'ARDA', skin: '#444' },
    'J0ffPerc': { nick: 'J0FF', skin: '#333' },
    'JellozBenz': { nick: 'JELLO', skin: '#444', aura: true },
    'kenenmusss': { nick: 'KAAN', skin: '#444' },
    'mageman5304': { nick: 'MAGE', skin: '#333', hat: 'black' },
    'nascarremy16': { nick: 'REMY', skin: '#3d2b1f' },
    'petnilongo3': { nick: 'KAYN', skin: '#333', hat: 'diamond' },
    'psychx777': { nick: 'PSYCH', skin: '#ffffff', aura: true, antlers: true },
    'Salomaoarruda': { nick: 'SALAMANCA', skin: '#c68642' },
    'TG37074': { nick: 'TG', skin: '#333', face: 'fire' },
    'Tyranizard89': { nick: 'TYRAN', skin: '#8d5524', face: 'dino' }
};

const keys = Object.keys(PLAYER_DB);
let userTeamKeys = [keys[2], keys[5], keys[13], keys[1]];
let gameTime = 300;
let matchActive = false;
let score = [0, 0];
let joy = { x: 0, y: 0, active: false };
let players = [];
let ball = { x: 0, y: 0, vx: 0, vy: 0, r: 10 };

// Render Logic for Avatars
function drawAvatar(ctx, x, y, k, teamColor, isPlayer = true) {
    const data = PLAYER_DB[k];
    ctx.save();
    ctx.translate(x, y);

    // Jersey
    ctx.fillStyle = teamColor;
    ctx.beginPath(); ctx.roundRect(-15, 5, 30, 25, 5); ctx.fill();

    // Head
    ctx.fillStyle = data.skin;
    ctx.beginPath(); ctx.arc(0, -5, 14, 0, 7); ctx.fill();

    // Eyes
    ctx.fillStyle = 'white';
    ctx.beginPath(); ctx.arc(-5, -7, 3, 0, 7); ctx.fill();
    ctx.beginPath(); ctx.arc(5, -7, 3, 0, 7); ctx.fill();
    ctx.fillStyle = 'black';
    ctx.beginPath(); ctx.arc(-5, -7, 1.5, 0, 7); ctx.fill();
    ctx.beginPath(); ctx.arc(5, -7, 1.5, 0, 7); ctx.fill();

    // Specific Traits
    if(data.face === 'dog') { ctx.fillStyle='#444'; ctx.beginPath(); ctx.arc(-13, -5, 5, 0, 7); ctx.fill(); ctx.beginPath(); ctx.arc(13, -5, 5, 0, 7); ctx.fill(); }
    if(data.hat === 'grad') { ctx.fillStyle='black'; ctx.fillRect(-12,-18,24,4); ctx.fillRect(-2,-22,4,8); }
    if(data.face === 'fire') { ctx.fillStyle='orange'; ctx.beginPath(); ctx.moveTo(-8,-10); ctx.lineTo(0,-25); ctx.lineTo(8,-10); ctx.fill(); }
    if(data.antlers) { ctx.strokeStyle='#4b3621'; ctx.beginPath(); ctx.moveTo(-5,-10); ctx.lineTo(-12,-20); ctx.stroke(); }

    if(isPlayer) {
        ctx.fillStyle = 'white'; ctx.font = 'bold 12px Arial'; ctx.textAlign = 'center';
        ctx.fillText(data.nick, 0, -30);
    }
    ctx.restore();
}

// Locker Room Cycle
const selDiv = document.getElementById('selectors');
["GK", "DEF", "MID", "ATT"].forEach((pos, i) => {
    selDiv.innerHTML += `<div class="slot"><b>${pos}</b><br><span id="name-${i}">${PLAYER_DB[userTeamKeys[i]].nick}</span><br>
    <button class="cycle-btn" onclick="cycle(${i},-1)">◀</button> <button class="cycle-btn" onclick="cycle(${i},1)">▶</button></div>`;
});

function cycle(slot, dir) {
    let idx = keys.indexOf(userTeamKeys[slot]);
    do { idx = (idx + dir + keys.length) % keys.length; } while (userTeamKeys.includes(keys[idx]));
    userTeamKeys[slot] = keys[idx];
    document.getElementById(`name-${slot}`).innerText = PLAYER_DB[userTeamKeys[slot]].nick;
    renderLocker();
}

function renderLocker() {
    userTeamKeys.forEach((k, i) => {
        const c = document.getElementById(`pre-${i}`);
        const ctxP = c.getContext('2d');
        ctxP.clearRect(0,0,c.width,c.height);
        drawAvatar(ctxP, c.width/2, 60, k, '#00d2ff', false);
    });
}
renderLocker();

// Timer Logic
setInterval(() => {
    if (!matchActive || gameTime <= 0) return;
    gameTime--;
    const mins = Math.floor(gameTime / 60);
    const secs = gameTime % 60;
    document.getElementById('timer').innerText = `${mins}:${secs.toString().padStart(2, '0')}`;
    
    if (gameTime === 0 && score[0] !== score[1]) endGame();
}, 1000);

function startGame() {
    document.getElementById('menu').style.display = 'none';
    const gameCanvas = document.getElementById('gameCanvas');
    gameCanvas.style.display = 'block';
    document.getElementById('hud').style.display = 'block';
    document.getElementById('controls').style.display = 'block';
    gameCanvas.width = window.innerWidth; gameCanvas.height = window.innerHeight;
    
    gameTime = 300; score = [0, 0];
    matchActive = true;
    
    let comKeys = keys.filter(k => !userTeamKeys.includes(k)).sort(() => 0.5 - Math.random()).slice(0, 4);
    players = [];
    userTeamKeys.forEach((k, i) => players.push({ key: k, team: 'u', x: 150, y: (gameCanvas.height/5)*(i+1), cur: i===3, s: 4 }));
    comKeys.forEach((k, i) => players.push({ key: k, team: 'c', x: gameCanvas.width-150, y: (gameCanvas.height/5)*(i+1), cur: false, s: 3.5 }));
    
    ball.x = gameCanvas.width/2; ball.y = gameCanvas.height/2; ball.vx=0; ball.vy=0;
    requestAnimationFrame(loop);
}

function endGame() {
    matchActive = false;
    document.getElementById('end-screen').style.display = 'flex';
    document.getElementById('match-result').innerText = score[0] > score[1] ? "BLUE WINS!" : "RED WINS!";
}

function returnToLocker() {
    document.getElementById('end-screen').style.display = 'none';
    document.getElementById('menu').style.display = 'flex';
    document.getElementById('gameCanvas').style.display = 'none';
    document.getElementById('hud').style.display = 'none';
    document.getElementById('controls').style.display = 'none';
}

function loop() {
    if (!matchActive) return;
    const ctx = document.getElementById('gameCanvas').getContext('2d');
    const cw = window.innerWidth, ch = window.innerHeight;

    ctx.fillStyle = '#1a472a'; ctx.fillRect(0,0,cw,ch);
    ctx.strokeStyle = 'rgba(255,255,255,0.3)'; ctx.lineWidth = 4;
    ctx.strokeRect(10, 10, cw-20, ch-20);
    ctx.strokeRect(0, ch/2-80, 40, 160); // Goals
    ctx.strokeRect(cw-40, ch/2-80, 40, 160);

    ball.x += ball.vx; ball.y += ball.vy;
    ball.vx *= 0.98; ball.vy *= 0.98;

    if(ball.y < ball.r || ball.y > ch-ball.r) ball.vy *= -1;
    if(ball.x < ball.r || ball.x > cw-ball.r) {
        if(ball.y > ch/2-80 && ball.y < ch/2+80) {
            if(ball.x < cw/2) score[1]++; else score[0]++;
            ball.x = cw/2; ball.y = ch/2; ball.vx=0; ball.vy=0;
            if (gameTime <= 0) endGame(); // Golden Goal check
        } else { ball.vx *= -1; }
    }
    ball.x = Math.max(ball.r, Math.min(cw-ball.r, ball.x));
    ball.y = Math.max(ball.r, Math.min(ch-ball.r, ball.y));

    players.forEach(p => {
        if(p.cur) { p.x += joy.x*p.s; p.y += joy.y*p.s; }
        else {
            let dx = ball.x - p.x, dy = ball.y - p.y, dist = Math.sqrt(dx*dx+dy*dy);
            p.x += (dx/dist)*p.s; p.y += (dy/dist)*p.s;
        }
        p.x = Math.max(20, Math.min(cw-20, p.x)); p.y = Math.max(20, Math.min(ch-20, p.y));
        let dx = ball.x-p.x, dy = ball.y-p.y, d = Math.sqrt(dx*dx+dy*dy);
        if(d < 25) { 
            ball.vx = dx*0.6; ball.vy = dy*0.6; 
            if (p.team === 'u') { // Indicator Arrow bounce
                ctx.fillStyle = varColor('--neon');
            }
        }
        drawAvatar(ctx, p.x, p.y, p.key, p.team==='u'?'#00d2ff':'#ff3131');
    });

    ctx.fillStyle = 'white'; ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.r, 0, 7); ctx.fill();
    document.getElementById('scoreboard').innerText = `BLUE ${score[0]} - ${score[1]} RED`;
    requestAnimationFrame(loop);
}

// Controller Logic
window.addEventListener('touchstart', e => {
    const t = e.touches[0];
    const b = document.getElementById('joy-base').getBoundingClientRect();
    if(t.clientX > b.left && t.clientX < b.right) joy.active = true;
    if(e.target.id === 'switch-btn') {
        let idx = players.findIndex(p => p.cur); players[idx].cur = false;
        players[(idx + 1) % 4].cur = true;
    }
    if(e.target.id === 'shoot-btn') {
        let p = players.find(p => p.cur);
        let dx = (p.team==='u'?window.innerWidth:0)-p.x, dy = (window.innerHeight/2)-p.y, d = Math.sqrt(dx*dx+dy*dy);
        ball.vx = (dx/d)*18; ball.vy = (dy/d)*18;
    }
});
window.addEventListener('touchmove', e => {
    if(!joy.active) return;
    const t = e.touches[0];
    const b = document.getElementById('joy-base').getBoundingClientRect();
    joy.x = (t.clientX - (b.left + 50)) / 40; joy.y = (t.clientY - (b.top + 50)) / 40;
    document.getElementById('joy-stick').style.transform = `translate(${joy.x*25}px, ${joy.y*25}px)`;
});
window.addEventListener('touchend', () => { joy.active=false; joy.x=0; joy.y=0; document.getElementById('joy-stick').style.transform=`translate(0,0)`; });

function varColor(name) { return getComputedStyle(document.documentElement).getPropertyValue(name); }
</script>
</body>
</html>
